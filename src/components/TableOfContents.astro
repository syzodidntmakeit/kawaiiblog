---
import type { MarkdownHeading } from "astro";

interface Props {
  headings: MarkdownHeading[];
}

const { headings } = Astro.props;

const filteredHeadings = headings.filter((h) => h.depth <= 3);
---

<nav class="toc">
  <details class="toc-details" open>
    <summary class="toc-title">On this page</summary>
    <ul class="toc-list">
      {
        filteredHeadings.map((heading) => (
          <li class={`toc-item depth-${heading.depth}`}>
            <a href={`#${heading.slug}`}>{heading.text}</a>
          </li>
        ))
      }
    </ul>
  </details>
</nav>

<script>
  // Smooth scroll behavior
  document.querySelectorAll(".toc a").forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault();
      const href = this.getAttribute("href");
      if (href) {
        const target = document.querySelector(href);
        if (target) {
          target.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
          // Update URL without jump
          history.pushState(null, "", href);
        }
      }
    });
  });
</script>

<style>
  .toc {
    padding: var(--spacing-md);
    border-left: 1px solid rgba(255, 192, 203, 0.1);
  }

  .toc-title {
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--muted);
    margin-bottom: var(--spacing-sm);
  }

  .toc-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .toc-item {
    margin-bottom: 0.5rem;
  }

  .toc-item a {
    color: var(--text);
    font-size: 0.9rem;
    opacity: 0.8;
    display: block;
    line-height: 1.4;
  }

  .toc-item a:hover {
    color: var(--pink);
    opacity: 1;
    text-decoration: none;
  }

  .depth-3 {
    padding-left: 1rem;
    font-size: 0.85rem;
  }

  /* Hide TOC on mobile */
  /* Custom marker for summary */
  details > summary {
    list-style: none;
    cursor: pointer;
  }
  details > summary::-webkit-details-marker {
    display: none;
  }

  /* Mobile styles */
  @media (max-width: 1024px) {
    .toc {
      margin-bottom: var(--spacing-lg);
      border-left: 2px solid var(--pink);
      background: rgba(255, 192, 203, 0.05);
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    }
  }
</style>
